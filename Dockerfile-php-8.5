FROM php:8.5-fpm-alpine

# ---- runtime dependencies ----
RUN apk add --no-cache \
    c-client curl gettext icu imagemagick imap krb5 libpng libxml2 libzip \
    oniguruma openldap openssl postgresql-libs tzdata

# ---- build dependencies ----
RUN apk add --no-cache --virtual .build-deps $PHPIZE_DEPS \
    curl-dev gettext-dev icu-dev imagemagick-dev imap-dev krb5-dev libpng-dev \
    libxml2-dev libzip-dev oniguruma-dev openldap-dev openssl-dev \
    postgresql-dev linux-headers \
&& docker-php-ext-install \
    bcmath calendar curl exif fileinfo gd gettext intl ldap mbstring pcntl \
    pdo_mysql pdo_pgsql pgsql shmop soap sockets sysvmsg sysvsem sysvshm \
    xml zip \
&& pecl install imagick imap xdebug \
&& docker-php-ext-enable imagick imap xdebug \
&& apk del .build-deps \
&& rm -rf /tmp/* /usr/local/lib/php/doc/* /var/cache/apk/*

COPY ./php/conf.d/*.ini /usr/local/etc/php/conf.d/

ENTRYPOINT ["docker-php-entrypoint"]
CMD ["php-fpm"]
